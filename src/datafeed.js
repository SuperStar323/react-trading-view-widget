import {
	makeApiRequest,
	generateSymbol,
	parseFullSymbol,
} from './helpers.js';
import axios from "axios";

import {
	subscribeOnStream,
	unsubscribeFromStream,
} from './streaming.js';

const lastBarsCache = new Map();

const configurationData = {
	supported_resolutions: ['1D', '1W', '1M'],
	exchanges: [{
		value: 'SOLANA',
		name: 'SOLANA',
		desc: 'SOLANA',
	}
	],
};

export default {
	onReady: (callback) => {
		console.log('[onReady]: Method call');
		setTimeout(() => callback(configurationData));
	},

	resolveSymbol: async (
		symbolName,
		onSymbolResolvedCallback,
		onResolveErrorCallback,
	) => {
		const symbolData = {
			ticker: "Solana:SOL/USD",
			name: "SOL/USD",
			description: "SOL/USD",
			type: "crypto",
			session: '24x7',
			timezone: 'Etc/UTC',
			exchange: "Solana",
			minmov: 1,
			pricescale: 100,
			has_intraday: false,
			has_no_volume: true,
			has_weekly_and_monthly: false,
			supported_resolutions: configurationData.supported_resolutions,
			volume_precision: 2,
			data_status: 'streaming',
		}
		onSymbolResolvedCallback(symbolData);
	},

	getBars: async (symbolInfo, resolution, periodParams, onHistoryCallback, onErrorCallback) => {
		const { from, to, firstDataRequest } = periodParams;
		console.log('[getBars]: Method call', symbolInfo, resolution, from, to);
		const parsedSymbol = parseFullSymbol(symbolInfo.full_name);
		const urlParameters = {
			e: parsedSymbol.exchange,
			fsym: parsedSymbol.fromSymbol,
			tsym: parsedSymbol.toSymbol,
			toTs: to,
			limit: 2000,
		};
		const query = Object.keys(urlParameters)
			.map(name => `${name}=${encodeURIComponent(urlParameters[name])}`)
			.join('&');

		try {
			const data = {
				"Response": "Success", "Type": 100, "Aggregated": false, "TimeTo": 1641513600, "TimeFrom": 1468713600, "FirstValueInArray": true, "ConversionType": { "type": "force_direct", "conversionSymbol": "" },
				"Data": [
					{
						"time": 1645056960000,
						"open": 101.77878312999727,
						"high": 101.77878312999727,
						"low": 101.77878312999727,
						"close": 101.77878312999727,
						"volume": 2185.75932
					},
					{
						"time": 1645060320000,
						"open": 102.53649827703613,
						"high": 102.53649827703613,
						"low": 102.53649827703613,
						"close": 102.53649827703613,
						"volume": 3272.161844
					},
					{
						"time": 1645064280000,
						"open": 101.91600821030075,
						"high": 101.91600821030075,
						"low": 101.91600821030075,
						"close": 101.91600821030075,
						"volume": 3318.1744
					},
					{
						"time": 1645066740000,
						"open": 101.40879577777778,
						"high": 101.40879577777778,
						"low": 101.40879577777778,
						"close": 101.40879577777778,
						"volume": 456.339581
					},
					{
						"time": 1645067820000,
						"open": 100.90402430284422,
						"high": 100.90402430284422,
						"low": 100.90402430284422,
						"close": 100.90402430284422,
						"volume": 3310.853891
					},
					{
						"time": 1645070340000,
						"open": 100.00542413575958,
						"high": 100.00542413575958,
						"low": 100.00542413575958,
						"close": 100.00542413575958,
						"volume": 3417.601673
					},
					{
						"time": 1645070580000,
						"open": 99.1293531651279,
						"high": 99.1293531651279,
						"low": 99.1293531651279,
						"close": 99.1293531651279,
						"volume": 3171.619906
					},
					{
						"time": 1645072500000,
						"open": 98.44079640776698,
						"high": 99.19966323668562,
						"low": 98.44079640776698,
						"close": 99.19966323668562,
						"volume": 5220.524572
					},
					{
						"time": 1645074540000,
						"open": 99.00177542094698,
						"high": 99.00177542094698,
						"low": 99.00177542094698,
						"close": 99.00177542094698,
						"volume": 99.452283
					},
					{
						"time": 1645078860000,
						"open": 99.59841771482762,
						"high": 100.03467810797662,
						"low": 99.59841771482762,
						"close": 100.03467810797662,
						"volume": 3285.126234
					},
					{
						"time": 1645084440000,
						"open": 99.56765413636363,
						"high": 100.2779909682545,
						"low": 99.56765413636363,
						"close": 100.2779909682545,
						"volume": 5223.236631
					},
					{
						"time": 1645086360000,
						"open": 100.02895128205128,
						"high": 100.02895128205128,
						"low": 99.53677925769381,
						"close": 99.53677925769381,
						"volume": 3698.6065139999996
					},
					{
						"time": 1645087080000,
						"open": 99.08415316547526,
						"high": 99.08415316547526,
						"low": 99.08415316547526,
						"close": 99.08415316547526,
						"volume": 99.137032
					},
					{
						"time": 1645088280000,
						"open": 99.681338,
						"high": 99.681338,
						"low": 99.084226,
						"close": 99.084226,
						"volume": 198.76556399999998
					},
					{
						"time": 1645089660000,
						"open": 98.66860604257658,
						"high": 98.66860604257658,
						"low": 97.543994,
						"close": 98.40561974241139,
						"volume": 9327.530024
					},
					{
						"time": 1645099260000,
						"open": 99.2491285403045,
						"high": 99.70319664442611,
						"low": 99.105844,
						"close": 99.105844,
						"volume": 3507.507735
					},
					{
						"time": 1645100700000,
						"open": 98.56662317617867,
						"high": 100.89308839911645,
						"low": 98.56662317617867,
						"close": 99.91492139771482,
						"volume": 20774.996766999997
					},
					{
						"time": 1645101120000,
						"open": 98.98591304913569,
						"high": 98.98591304913569,
						"low": 98.98591304913569,
						"close": 98.98591304913569,
						"volume": 3904.323721
					},
					{
						"time": 1645104180000,
						"open": 98.06659131751013,
						"high": 98.06659131751013,
						"low": 98.06659131751013,
						"close": 98.06659131751013,
						"volume": 3047.985338
					},
					{
						"time": 1645109760000,
						"open": 97.21674033048305,
						"high": 97.21674033048305,
						"low": 97.21674033048305,
						"close": 97.21674033048305,
						"volume": 3407.138373
					},
					{
						"time": 1645119900000,
						"open": 96.75697067191936,
						"high": 96.75697067191936,
						"low": 96.75697067191936,
						"close": 96.75697067191936,
						"volume": 95.95575
					},
					{
						"time": 1645120020000,
						"open": 96.34524824080772,
						"high": 96.34524824080772,
						"low": 96.34524824080772,
						"close": 96.34524824080772,
						"volume": 3050.359561
					},
					{
						"time": 1645122060000,
						"open": 95.68474176190476,
						"high": 95.68474176190476,
						"low": 94.990803,
						"close": 94.990803,
						"volume": 5334.057682
					},
					{
						"time": 1645130160000,
						"open": 94.1332412,
						"high": 94.1332412,
						"low": 94.1332412,
						"close": 94.1332412,
						"volume": 3294.663442
					},
					{
						"time": 1645133160000,
						"open": 92.97301449444168,
						"high": 92.97301449444168,
						"low": 92.97301449444168,
						"close": 92.97301449444168,
						"volume": 5705.23685
					},
					{
						"time": 1645133700000,
						"open": 93.20103291407058,
						"high": 93.20103291407058,
						"low": 93.04123488372093,
						"close": 93.04123488372093,
						"volume": 3186.171658
					},
					{
						"time": 1645135260000,
						"open": 93.99745246834188,
						"high": 93.99745246834188,
						"low": 93.83423,
						"close": 93.83423,
						"volume": 3122.379562
					},
					{
						"time": 1645136580000,
						"open": 93.39811249687821,
						"high": 93.39811249687821,
						"low": 93.39811249687821,
						"close": 93.39811249687821,
						"volume": 3375.183293
					},
					{
						"time": 1645140120000,
						"open": 93.92055347224357,
						"high": 93.92055347224357,
						"low": 93.92055347224357,
						"close": 93.92055347224357,
						"volume": 3080.860968
					},
					{
						"time": 1645142400000,
						"open": 93.51620282828283,
						"high": 93.51620282828283,
						"low": 93.51620282828283,
						"close": 93.51620282828283,
						"volume": 1851.620816
					},
					{
						"time": 1645146060000,
						"open": 93.93305798882811,
						"high": 93.93305798882811,
						"low": 93.93305798882811,
						"close": 93.93305798882811,
						"volume": 723.728303
					},
					{
						"time": 1645148220000,
						"open": 94.17533192050945,
						"high": 94.88646910580627,
						"low": 94.17533192050945,
						"close": 94.88646910580627,
						"volume": 4827.535175
					},
					{
						"time": 1645151760000,
						"open": 94.5222069995944,
						"high": 94.5222069995944,
						"low": 94.19276745875399,
						"close": 94.19276745875399,
						"volume": 2545.5791289999997
					},
					{
						"time": 1645152960000,
						"open": 94.03381,
						"high": 94.03381,
						"low": 94.03381,
						"close": 94.03381,
						"volume": 112.840572
					},
					{
						"time": 1645168380000,
						"open": 94.66680649893333,
						"high": 94.66680649893333,
						"low": 94.66680649893333,
						"close": 94.66680649893333,
						"volume": 625.58018
					},
					{
						"time": 1645171560000,
						"open": 94.82953403401673,
						"high": 95.01724007876341,
						"low": 94.82953403401673,
						"close": 95.01724007876341,
						"volume": 1446.566351
					},
					{
						"time": 1645173240000,
						"open": 95.53231544596748,
						"high": 95.53231544596748,
						"low": 95.53231544596748,
						"close": 95.53231544596748,
						"volume": 3150.52283
					},
					{
						"time": 1645177980000,
						"open": 95.36798999999999,
						"high": 95.36798999999999,
						"low": 95.36798999999999,
						"close": 95.36798999999999,
						"volume": 9.536799
					},
					{
						"time": 1645182660000,
						"open": 94.96491420177209,
						"high": 94.96491420177209,
						"low": 94.96491420177209,
						"close": 94.96491420177209,
						"volume": 3093.486973
					},
					{
						"time": 1645184100000,
						"open": 94.56233999999999,
						"high": 94.56233999999999,
						"low": 94.16310867998142,
						"close": 94.16310867998142,
						"volume": 3086.460943
					},
					{
						"time": 1645185840000,
						"open": 93.743855,
						"high": 93.743855,
						"low": 93.743855,
						"close": 93.743855,
						"volume": 168.738939
					},
					{
						"time": 1645194840000,
						"open": 93.63958536934571,
						"high": 93.63958536934571,
						"low": 91.56299711744458,
						"close": 91.56299711744458,
						"volume": 9922.447337
					},
					{
						"time": 1645196040000,
						"open": 92.15235852491216,
						"high": 93.0785580021224,
						"low": 92.15235852491216,
						"close": 93.0785580021224,
						"volume": 7227.0213889999995
					},
					{
						"time": 1645196760000,
						"open": 92.61968964495763,
						"high": 92.61968964495763,
						"low": 92.61968964495763,
						"close": 92.61968964495763,
						"volume": 3140.145358
					},
					{
						"time": 1645198260000,
						"open": 91.83094952960688,
						"high": 91.83094952960688,
						"low": 91.83094952960688,
						"close": 91.83094952960688,
						"volume": 3025.481388
					},
					{
						"time": 1645199160000,
						"open": 91.05278385706258,
						"high": 91.05278385706258,
						"low": 91.05278385706258,
						"close": 91.05278385706258,
						"volume": 3083.417585
					},
					{
						"time": 1645202880000,
						"open": 91.21919203177904,
						"high": 91.21919203177904,
						"low": 91.21919203177904,
						"close": 91.21919203177904,
						"volume": 91.793489
					},
					{
						"time": 1645206780000,
						"open": 90.6727672082651,
						"high": 90.6727672082651,
						"low": 90.6727672082651,
						"close": 90.6727672082651,
						"volume": 91.243624
					},
					{
						"time": 1645207560000,
						"open": 90.24506108260195,
						"high": 90.24506108260195,
						"low": 90.24506108260195,
						"close": 90.24506108260195,
						"volume": 6571.34436
					},
					{
						"time": 1645213080000,
						"open": 90.38246192232221,
						"high": 90.38246192232221,
						"low": 90.38246192232221,
						"close": 90.38246192232221,
						"volume": 90.434248
					},
					{
						"time": 1645214040000,
						"open": 90.09191315317938,
						"high": 90.4051698202047,
						"low": 90.09191315317938,
						"close": 90.4051698202047,
						"volume": 1871.6242040000002
					},
					{
						"time": 1645219740000,
						"open": 90.60826017471527,
						"high": 90.60826017471527,
						"low": 90.60826017471527,
						"close": 90.60826017471527,
						"volume": 985.975031
					},
					{
						"time": 1645221600000,
						"open": 90.10897795750196,
						"high": 90.10897795750196,
						"low": 90.10897795750196,
						"close": 90.10897795750196,
						"volume": 641.184492
					},
					{
						"time": 1645222080000,
						"open": 89.92743581613544,
						"high": 89.92743581613544,
						"low": 89.92743581613544,
						"close": 89.92743581613544,
						"volume": 795.410591
					},
					{
						"time": 1645222620000,
						"open": 89.74656013887453,
						"high": 89.74656013887453,
						"low": 89.5842203621216,
						"close": 89.5842203621216,
						"volume": 1287.045589
					},
					{
						"time": 1645224900000,
						"open": 89.4796655,
						"high": 89.4796655,
						"low": 89.4796655,
						"close": 89.4796655,
						"volume": 178.959331
					},
					{
						"time": 1645230840000,
						"open": 90.38026295867935,
						"high": 90.38026295867935,
						"low": 90.38026295867935,
						"close": 90.38026295867935,
						"volume": 3043.414846
					},
					{
						"time": 1645233660000,
						"open": 90.16291566037737,
						"high": 91.0273556448657,
						"low": 90.16291566037737,
						"close": 91.0273556448657,
						"volume": 3493.6781379999998
					},
					{
						"time": 1645240260000,
						"open": 91.860609017469,
						"high": 91.860609017469,
						"low": 91.860609017469,
						"close": 91.860609017469,
						"volume": 3527.679796
					},
					{
						"time": 1645241520000,
						"open": 91.748027,
						"high": 91.748027,
						"low": 91.31844900033951,
						"close": 91.31844900033951,
						"volume": 3248.726133
					},
					{
						"time": 1645248060000,
						"open": 91.5574875992222,
						"high": 91.71214364206179,
						"low": 91.5574875992222,
						"close": 91.71214364206179,
						"volume": 1212.9115649999999
					},
					{
						"time": 1645252920000,
						"open": 92.10847761190283,
						"high": 92.10847761190283,
						"low": 92.10847761190283,
						"close": 92.10847761190283,
						"volume": 2500
					},
					{
						"time": 1645259160000,
						"open": 91.75215952486138,
						"high": 91.75215952486138,
						"low": 91.75215952486138,
						"close": 91.75215952486138,
						"volume": 966.437972
					},
					{
						"time": 1645259640000,
						"open": 91.59727345350312,
						"high": 91.59727345350312,
						"low": 91.59727345350312,
						"close": 91.59727345350312,
						"volume": 247.2406
					},
					{
						"time": 1645260780000,
						"open": 91.14476220770109,
						"high": 91.14476220770109,
						"low": 91.14476220770109,
						"close": 91.14476220770109,
						"volume": 3307.589287
					},
					{
						"time": 1645269660000,
						"open": 90.22174723347537,
						"high": 90.22174723347537,
						"low": 90.22174723347537,
						"close": 90.22174723347537,
						"volume": 3968.576945
					},
					{
						"time": 1645274280000,
						"open": 89.59613481818182,
						"high": 89.59613481818182,
						"low": 89.59613481818182,
						"close": 89.59613481818182,
						"volume": 985.557483
					},
					{
						"time": 1645278420000,
						"open": 90.07707118444837,
						"high": 90.07707118444837,
						"low": 90.07707118444837,
						"close": 90.07707118444837,
						"volume": 2500
					},
					{
						"time": 1645285500000,
						"open": 90.71026340928105,
						"high": 90.71026340928105,
						"low": 90.71026340928105,
						"close": 90.71026340928105,
						"volume": 2500
					},
					{
						"time": 1645287540000,
						"open": 91.4091151979346,
						"high": 91.80413568822992,
						"low": 91.4091151979346,
						"close": 91.80413568822992,
						"volume": 3091.091889
					},
					{
						"time": 1645289640000,
						"open": 91.24982700729926,
						"high": 91.24982700729926,
						"low": 91.18421695652175,
						"close": 91.18421695652175,
						"volume": 425.30288900000005
					},
					{
						"time": 1645290060000,
						"open": 90.9496295,
						"high": 90.9496295,
						"low": 90.9496295,
						"close": 90.9496295,
						"volume": 1637.093331
					},
					{
						"time": 1645300440000,
						"open": 90.34102142857144,
						"high": 90.34102142857144,
						"low": 90.34102142857144,
						"close": 90.34102142857144,
						"volume": 3161.93575
					},
					{
						"time": 1645314000000,
						"open": 90.87012892011772,
						"high": 90.87012892011772,
						"low": 90.87012892011772,
						"close": 90.87012892011772,
						"volume": 3059.358743
					},
					{
						"time": 1645317600000,
						"open": 90.31890826540531,
						"high": 90.31890826540531,
						"low": 90.31890826540531,
						"close": 90.31890826540531,
						"volume": 3113.182304
					},
					{
						"time": 1645325760000,
						"open": 89.50349139407041,
						"high": 89.50349139407041,
						"low": 89.50349139407041,
						"close": 89.50349139407041,
						"volume": 3343.099551
					},
					{
						"time": 1645327680000,
						"open": 88.6068631938927,
						"high": 88.6068631938927,
						"low": 88.6068631938927,
						"close": 88.6068631938927,
						"volume": 3790.027339
					},
					{
						"time": 1645331880000,
						"open": 87.6955480078126,
						"high": 87.6955480078126,
						"low": 87.6955480078126,
						"close": 87.6955480078126,
						"volume": 3497.859405
					},
					{
						"time": 1645337820000,
						"open": 86.88408816718514,
						"high": 86.88408816718514,
						"low": 86.88408816718514,
						"close": 86.88408816718514,
						"volume": 3023.566269
					},
					{
						"time": 1645344780000,
						"open": 86.43705679452869,
						"high": 86.43705679452869,
						"low": 86.43705679452869,
						"close": 86.43705679452869,
						"volume": 581.375644
					},
					{
						"time": 1645347240000,
						"open": 86.99135793146289,
						"high": 87.47747185991183,
						"low": 86.99135793146289,
						"close": 87.47747185991183,
						"volume": 2684.5757169999997
					},
					{
						"time": 1645347660000,
						"open": 87.62901344516231,
						"high": 89.04500188942954,
						"low": 87.62901344516231,
						"close": 89.04500188942954,
						"volume": 7609.609285
					},
					{
						"time": 1645348980000,
						"open": 88.84965010856592,
						"high": 88.84965010856592,
						"low": 88.05963172873221,
						"close": 88.05963172873221,
						"volume": 3750.642205
					},
					{
						"time": 1645349940000,
						"open": 88.62942398525786,
						"high": 88.81747684031468,
						"low": 88.62942398525786,
						"close": 88.81747684031468,
						"volume": 1498.348526
					},
					{
						"time": 1645351440000,
						"open": 87.81500242424244,
						"high": 88.96187262256296,
						"low": 87.81500242424244,
						"close": 88.96187262256296,
						"volume": 10901.279621000001
					},
					{
						"time": 1645356540000,
						"open": 88.77936506222899,
						"high": 88.77936506222899,
						"low": 88.77936506222899,
						"close": 88.77936506222899,
						"volume": 1018.199828
					},
					{
						"time": 1645356660000,
						"open": 88.57534319352848,
						"high": 88.57534319352848,
						"low": 88.57534319352848,
						"close": 88.57534319352848,
						"volume": 608.201726
					},
					{
						"time": 1645359480000,
						"open": 89.11813440362806,
						"high": 90.34179887289982,
						"low": 89.11813440362806,
						"close": 89.63852295828605,
						"volume": 10742.1485
					},
					{
						"time": 1645360320000,
						"open": 89.47691569123366,
						"high": 89.47691569123366,
						"low": 89.31890446905648,
						"close": 89.31890446905648,
						"volume": 1254.819696
					},
					{
						"time": 1645361400000,
						"open": 89.16645043652957,
						"high": 89.16645043652957,
						"low": 88.86936120868037,
						"close": 88.86936120868037,
						"volume": 1780.2138409999998
					},
					{
						"time": 1645363320000,
						"open": 89.41149185265122,
						"high": 90.34344685518043,
						"low": 89.41149185265122,
						"close": 89.75171039852498,
						"volume": 10775.183078999999
					},
					{
						"time": 1645364220000,
						"open": 88.93466171717053,
						"high": 88.93466171717053,
						"low": 88.93466171717053,
						"close": 88.93466171717053,
						"volume": 3262.403637
					},
					{
						"time": 1645366740000,
						"open": 88.03362822693545,
						"high": 88.52281411568002,
						"low": 88.03362822693545,
						"close": 88.52281411568002,
						"volume": 7551.187288
					},
					{
						"time": 1645372320000,
						"open": 89.29200028946266,
						"high": 89.60988499999999,
						"low": 89.29200028946266,
						"close": 89.60988499999999,
						"volume": 2517.921977
					},
					{
						"time": 1645373460000,
						"open": 89.62116875,
						"high": 90.0286267309788,
						"low": 89.62116875,
						"close": 90.0286267309788,
						"volume": 3236.489371
					},
					{
						"time": 1645374180000,
						"open": 89.87691,
						"high": 89.87691,
						"low": 89.87691,
						"close": 89.87691,
						"volume": 89.87691
					},
					{
						"time": 1645378860000,
						"open": 90.54989811968132,
						"high": 90.54989811968132,
						"low": 90.1475380952381,
						"close": 90.1475380952381,
						"volume": 1147.780982
					},
					{
						"time": 1645379220000,
						"open": 91.10273154528547,
						"high": 91.10273154528547,
						"low": 91.10273154528547,
						"close": 91.10273154528547,
						"volume": 3271.609792
					},
					{
						"time": 1645382040000,
						"open": 91.91499700174094,
						"high": 93.06257315236793,
						"low": 91.91499700174094,
						"close": 92.99425990406591,
						"volume": 8970.813913000002
					},
					{
						"time": 1645383720000,
						"open": 92.77611904106686,
						"high": 92.77611904106686,
						"low": 92.21013738777032,
						"close": 92.21013738777032,
						"volume": 4419.286597
					},
					{
						"time": 1645390500000,
						"open": 91.36702213362133,
						"high": 91.36702213362133,
						"low": 91.36702213362133,
						"close": 91.36702213362133,
						"volume": 3203.58603
					},
					{
						"time": 1645392660000,
						"open": 90.47260314364087,
						"high": 90.47260314364087,
						"low": 90.47260314364087,
						"close": 90.47260314364087,
						"volume": 3839.965128
					},
					{
						"time": 1645394400000,
						"open": 90.92459499815463,
						"high": 90.92459499815463,
						"low": 90.92459499815463,
						"close": 90.92459499815463,
						"volume": 3125.641886
					},
					{
						"time": 1645394940000,
						"open": 91.72545988791259,
						"high": 91.72545988791259,
						"low": 91.72545988791259,
						"close": 91.72545988791259,
						"volume": 3167.911211
					},
					{
						"time": 1645397880000,
						"open": 92.21918648655608,
						"high": 92.79854399270235,
						"low": 92.21918648655608,
						"close": 92.64559653950448,
						"volume": 5227.644136
					},
					{
						"time": 1645399080000,
						"open": 92.1311692307362,
						"high": 92.1311692307362,
						"low": 92.1311692307362,
						"close": 92.1311692307362,
						"volume": 3325.128551
					},
					{
						"time": 1645400820000,
						"open": 91.68819520525086,
						"high": 91.68819520525086,
						"low": 91.25731187440412,
						"close": 91.25731187440412,
						"volume": 3384.361511
					},
					{
						"time": 1645404180000,
						"open": 91.774288233588,
						"high": 91.774288233588,
						"low": 91.774288233588,
						"close": 91.774288233588,
						"volume": 3000
					},
					{
						"time": 1645405140000,
						"open": 92.54264563407668,
						"high": 92.54264563407668,
						"low": 92.54264563407668,
						"close": 92.54264563407668,
						"volume": 3010.847048
					},
					{
						"time": 1645405680000,
						"open": 93.3258313271436,
						"high": 93.3258313271436,
						"low": 93.3258313271436,
						"close": 93.3258313271436,
						"volume": 3090.662363
					},
					{
						"time": 1645407600000,
						"open": 94.12665745963403,
						"high": 94.12665745963403,
						"low": 94.12665745963403,
						"close": 94.12665745963403,
						"volume": 3121.720163
					},
					{
						"time": 1645415760000,
						"open": 93.85318443243244,
						"high": 93.85318443243244,
						"low": 93.85318443243244,
						"close": 93.85318443243244,
						"volume": 868.141956
					},
					{
						"time": 1645422120000,
						"open": 94.5323664273344,
						"high": 95.27558714359564,
						"low": 94.36110266423155,
						"close": 94.36110266423155,
						"volume": 10616.474634
					},
					{
						"time": 1645423740000,
						"open": 92.7626232,
						"high": 93.57142817003654,
						"low": 92.5912385989338,
						"close": 93.57142817003654,
						"volume": 15194.108783
					},
					{
						"time": 1645425180000,
						"open": 91.9096838,
						"high": 94.1910873890812,
						"low": 91.9096838,
						"close": 94.1910873890812,
						"volume": 42180.242706000005
					},
					{
						"time": 1645425960000,
						"open": 92.91358974999999,
						"high": 94.652077476802,
						"low": 91.6415373577025,
						"close": 94.39958863019405,
						"volume": 69512.600623
					},
					{
						"time": 1645430520000,
						"open": 95.02696975374425,
						"high": 95.02696975374425,
						"low": 95.02696975374425,
						"close": 95.02696975374425,
						"volume": 996.895906
					},
					{
						"time": 1645433880000,
						"open": 94.50641487914102,
						"high": 94.50641487914102,
						"low": 94.3212198584258,
						"close": 94.3212198584258,
						"volume": 1431.999843
					},
					{
						"time": 1645437420000,
						"open": 94.13753777241577,
						"high": 94.13753777241577,
						"low": 93.79210319697263,
						"close": 93.79210319697263,
						"volume": 1947.3853920000001
					},
					{
						"time": 1645438920000,
						"open": 93.62939655754003,
						"high": 93.62939655754003,
						"low": 93.09541299531074,
						"close": 93.09541299531074,
						"volume": 2622.5862720000005
					},
					{
						"time": 1645442160000,
						"open": 92.64429559500725,
						"high": 92.64429559500725,
						"low": 92.64429559500725,
						"close": 92.64429559500725,
						"volume": 3077.671208
					},
					{
						"time": 1645443480000,
						"open": 91.76314837981003,
						"high": 91.76314837981003,
						"low": 90.05287143257829,
						"close": 90.05287143257829,
						"volume": 10339.879095
					},
					{
						"time": 1645444080000,
						"open": 89.23160687359102,
						"high": 89.23160687359102,
						"low": 89.23160687359102,
						"close": 89.23160687359102,
						"volume": 6257.306962
					},
					{
						"time": 1645450740000,
						"open": 87.48171823399446,
						"high": 87.48171823399446,
						"low": 87.48171823399446,
						"close": 87.48171823399446,
						"volume": 3051.398289
					},
					{
						"time": 1645452540000,
						"open": 88.02313043114668,
						"high": 88.02313043114668,
						"low": 88.02313043114668,
						"close": 88.02313043114668,
						"volume": 3183.526046
					},
					{
						"time": 1645453080000,
						"open": 88.79711966516838,
						"high": 91.28000013683173,
						"low": 88.79711966516838,
						"close": 90.56426777561715,
						"volume": 24392.238993
					},
					{
						"time": 1645456020000,
						"open": 91.28280599971538,
						"high": 91.28280599971538,
						"low": 91.28280599971538,
						"close": 91.28280599971538,
						"volume": 2500
					},
					{
						"time": 1645458420000,
						"open": 90.6621979187617,
						"high": 90.6621979187617,
						"low": 89.86134128758003,
						"close": 89.86134128758003,
						"volume": 6333.2183939999995
					},
					{
						"time": 1645463040000,
						"open": 89.06796769251577,
						"high": 89.06796769251577,
						"low": 89.06796769251577,
						"close": 89.06796769251577,
						"volume": 3050.443758
					},
					{
						"time": 1645466100000,
						"open": 88.67528295454545,
						"high": 88.67528295454545,
						"low": 88.67528295454545,
						"close": 88.67528295454545,
						"volume": 78.034249
					},
					{
						"time": 1645466700000,
						"open": 88.00181379969102,
						"high": 88.00181379969102,
						"low": 88.00181379969102,
						"close": 88.00181379969102,
						"volume": 5303.536903
					},
					{
						"time": 1645468140000,
						"open": 86.9601944924586,
						"high": 86.9601944924586,
						"low": 86.9601944924586,
						"close": 86.9601944924586,
						"volume": 3067.217594
					},
					{
						"time": 1645469280000,
						"open": 87.35086912650152,
						"high": 87.35086912650152,
						"low": 87.35086912650152,
						"close": 87.35086912650152,
						"volume": 2009.78232
					},
					{
						"time": 1645471500000,
						"open": 87.04278031746031,
						"high": 87.04278031746031,
						"low": 87.04278031746031,
						"close": 87.04278031746031,
						"volume": 274.184758
					},
					{
						"time": 1645473360000,
						"open": 87.65688357347608,
						"high": 87.65688357347608,
						"low": 87.65688357347608,
						"close": 87.65688357347608,
						"volume": 995.569328
					},
					{
						"time": 1645475760000,
						"open": 86.47703575172415,
						"high": 86.7942584733361,
						"low": 86.31248306929845,
						"close": 86.7942584733361,
						"volume": 10167.455662
					},
					{
						"time": 1645478340000,
						"open": 87.57556575346545,
						"high": 87.57556575346545,
						"low": 87.57556575346545,
						"close": 87.57556575346545,
						"volume": 3139.227198
					},
					{
						"time": 1645479660000,
						"open": 87.34691553323186,
						"high": 87.34691553323186,
						"low": 86.85837152582428,
						"close": 86.85837152582428,
						"volume": 3933.453801
					},
					{
						"time": 1645480320000,
						"open": 86.0378880814987,
						"high": 86.0378880814987,
						"low": 85.04453637749172,
						"close": 85.04453637749172,
						"volume": 8068.525585
					},
					{
						"time": 1645481880000,
						"open": 85.15785516656624,
						"high": 85.15785516656624,
						"low": 85.15785516656624,
						"close": 85.15785516656624,
						"volume": 1383.263461
					},
					{
						"time": 1645485420000,
						"open": 84.6919411376075,
						"high": 84.6919411376075,
						"low": 84.01537668835321,
						"close": 84.01537668835321,
						"volume": 5179.774148
					},
					{
						"time": 1645487220000,
						"open": 83.07618312186801,
						"high": 83.07618312186801,
						"low": 83.07618312186801,
						"close": 83.07618312186801,
						"volume": 3917.259574
					},
					{
						"time": 1645489560000,
						"open": 83.47069990144979,
						"high": 83.47069990144979,
						"low": 83.47069990144979,
						"close": 83.47069990144979,
						"volume": 3064.220352
					},
					{
						"time": 1645493040000,
						"open": 82.90268852635077,
						"high": 82.90268852635077,
						"low": 82.90268852635077,
						"close": 82.90268852635077,
						"volume": 3624.257535
					},
					{
						"time": 1645493940000,
						"open": 83.34562960616186,
						"high": 83.34562960616186,
						"low": 83.34562960616186,
						"close": 83.34562960616186,
						"volume": 3177.443781
					},
					{
						"time": 1645499460000,
						"open": 82.99999478545755,
						"high": 82.99999478545755,
						"low": 82.99999478545755,
						"close": 82.99999478545755,
						"volume": 1909.67673
					},
					{
						"time": 1645499940000,
						"open": 82.27115255999999,
						"high": 82.27115255999999,
						"low": 82.27115255999999,
						"close": 82.27115255999999,
						"volume": 4113.557628
					},
					{
						"time": 1645511700000,
						"open": 82.34760985854508,
						"high": 82.84648928724941,
						"low": 82.34760985854508,
						"close": 82.69028335557783,
						"volume": 4794.576145
					},
					{
						"time": 1645512720000,
						"open": 82.58195689045937,
						"high": 82.58195689045937,
						"low": 82.58195689045937,
						"close": 82.58195689045937,
						"volume": 233.706938
					},
					{
						"time": 1645514880000,
						"open": 82.13376047812046,
						"high": 82.13376047812046,
						"low": 82.13376047812046,
						"close": 82.13376047812046,
						"volume": 3477.964725
					},
					{
						"time": 1645517580000,
						"open": 82.21716439376561,
						"high": 82.23702153163752,
						"low": 82.21716439376561,
						"close": 82.23702153163752,
						"volume": 164.554842
					},
					{
						"time": 1645518420000,
						"open": 82.61011309213364,
						"high": 82.61011309213364,
						"low": 82.61011309213364,
						"close": 82.61011309213364,
						"volume": 3013.532991
					},
					{
						"time": 1645521300000,
						"open": 83.01330072030648,
						"high": 83.41404539389592,
						"low": 83.01330072030648,
						"close": 83.24056974265747,
						"volume": 7235.722119999999
					},
					{
						"time": 1645525800000,
						"open": 84.65542605312203,
						"high": 85.06048047290673,
						"low": 84.65542605312203,
						"close": 84.87996374513112,
						"volume": 3623.908577
					},
					{
						"time": 1645531500000,
						"open": 84.82937253513735,
						"high": 84.82937253513735,
						"low": 84.82937253513735,
						"close": 84.82937253513735,
						"volume": 100.057734
					},
					{
						"time": 1645536000000,
						"open": 84.80856382200834,
						"high": 84.80856382200834,
						"low": 84.80856382200834,
						"close": 84.80856382200834,
						"volume": 69.687754
					},
					{
						"time": 1645541100000,
						"open": 85.40902671565559,
						"high": 86.09238631893415,
						"low": 85.40902671565559,
						"close": 86.06472104872796,
						"volume": 6363.384255
					},
					{
						"time": 1645541880000,
						"open": 86.88009789519194,
						"high": 86.88009789519194,
						"low": 86.88009789519194,
						"close": 86.88009789519194,
						"volume": 3209.6356
					},
					{
						"time": 1645545120000,
						"open": 86.44624257664485,
						"high": 86.44624257664485,
						"low": 86.44624257664485,
						"close": 86.44624257664485,
						"volume": 2509.534422
					},
					{
						"time": 1645546440000,
						"open": 85.4223782358483,
						"high": 85.4223782358483,
						"low": 85.4223782358483,
						"close": 85.4223782358483,
						"volume": 5785.819087
					},
					{
						"time": 1645552980000,
						"open": 84.70493466666666,
						"high": 84.70493466666666,
						"low": 84.70493466666666,
						"close": 84.70493466666666,
						"volume": 63.528701
					},
					{
						"time": 1645559640000,
						"open": 85.61152692507642,
						"high": 85.61152692507642,
						"low": 85.61152692507642,
						"close": 85.61152692507642,
						"volume": 3293.247574
					},
					{
						"time": 1645562400000,
						"open": 85.49923684210526,
						"high": 85.49923684210526,
						"low": 85.49923684210526,
						"close": 85.49923684210526,
						"volume": 32.48971
					},
					{
						"time": 1645568640000,
						"open": 85.10918476884684,
						"high": 85.10918476884684,
						"low": 85.10918476884684,
						"close": 85.10918476884684,
						"volume": 3142.394429
					},
					{
						"time": 1645572540000,
						"open": 85.60807615668311,
						"high": 85.60807615668311,
						"low": 85.60807615668311,
						"close": 85.60807615668311,
						"volume": 3046.622707
					},
					{
						"time": 1645573380000,
						"open": 86.38791014177428,
						"high": 86.38791014177428,
						"low": 86.38791014177428,
						"close": 86.38791014177428,
						"volume": 3273.950782
					},
					{
						"time": 1645575420000,
						"open": 86.87303785937284,
						"high": 87.47765828753396,
						"low": 86.87303785937284,
						"close": 87.40137258371277,
						"volume": 5517.67392
					},
					{
						"time": 1645579980000,
						"open": 86.90249376208492,
						"high": 86.90249376208492,
						"low": 86.90249376208492,
						"close": 86.90249376208492,
						"volume": 3376.965567
					},
					{
						"time": 1645581840000,
						"open": 87.05470199411421,
						"high": 87.47668494088019,
						"low": 87.05470199411421,
						"close": 87.47668494088019,
						"volume": 3401.945868
					},
					{
						"time": 1645583340000,
						"open": 87.27572688264195,
						"high": 87.27572688264195,
						"low": 87.27572688264195,
						"close": 87.27572688264195,
						"volume": 400.328899
					},
					{
						"time": 1645584180000,
						"open": 86.80691552415914,
						"high": 86.80691552415914,
						"low": 86.80691552415914,
						"close": 86.80691552415914,
						"volume": 3376.660188
					},
					{
						"time": 1645590060000,
						"open": 87.28749935146176,
						"high": 87.28749935146176,
						"low": 87.28749935146176,
						"close": 87.28749935146176,
						"volume": 3052.979522
					},
					{
						"time": 1645592640000,
						"open": 88.04096959709551,
						"high": 88.04096959709551,
						"low": 88.04096959709551,
						"close": 88.04096959709551,
						"volume": 2994.858064
					},
					{
						"time": 1645595580000,
						"open": 88.44349924138074,
						"high": 88.845592364175,
						"low": 88.44349924138074,
						"close": 88.845592364175,
						"volume": 3217.033628
					},
					{
						"time": 1645604880000,
						"open": 89.26319072746621,
						"high": 89.68012494228071,
						"low": 89.26319072746621,
						"close": 89.47963987493381,
						"volume": 3640.625325
					},
					{
						"time": 1645612500000,
						"open": 90.36987835046664,
						"high": 91.08078474283563,
						"low": 90.36987835046664,
						"close": 91.08078474283563,
						"volume": 5607.352359
					},
					{
						"time": 1645615560000,
						"open": 91.7167967776169,
						"high": 91.7167967776169,
						"low": 91.7167967776169,
						"close": 91.7167967776169,
						"volume": 2500
					},
					{
						"time": 1645616940000,
						"open": 92.12165573929231,
						"high": 92.92014470010587,
						"low": 92.12165573929231,
						"close": 92.23160580393484,
						"volume": 11119.685876
					},
					{
						"time": 1645621860000,
						"open": 92.3307976108684,
						"high": 92.92891727333853,
						"low": 92.3307976108684,
						"close": 92.79443849879542,
						"volume": 5374.501177
					},
					{
						"time": 1645623240000,
						"open": 92.30126859523025,
						"high": 92.30126859523025,
						"low": 92.30126859523025,
						"close": 92.30126859523025,
						"volume": 3160.185551
					},
					{
						"time": 1645625280000,
						"open": 91.45898438410401,
						"high": 91.45898438410401,
						"low": 91.45898438410401,
						"close": 91.45898438410401,
						"volume": 3444.172454
					},
					{
						"time": 1645626840000,
						"open": 91.9529401800807,
						"high": 91.9529401800807,
						"low": 91.9529401800807,
						"close": 91.9529401800807,
						"volume": 3014.36376
					},
					{
						"time": 1645627980000,
						"open": 91.40084491735837,
						"high": 91.40084491735837,
						"low": 91.40084491735837,
						"close": 91.40084491735837,
						"volume": 3023.833087
					},
					{
						"time": 1645628520000,
						"open": 90.5655688377109,
						"high": 90.5655688377109,
						"low": 90.5655688377109,
						"close": 90.5655688377109,
						"volume": 3557.707449
					},
					{
						"time": 1645630020000,
						"open": 89.70071707151058,
						"high": 89.70071707151058,
						"low": 89.70071707151058,
						"close": 89.70071707151058,
						"volume": 3289.666037
					},
					{
						"time": 1645631280000,
						"open": 86.55582521693367,
						"high": 92.0632624155318,
						"low": 84.64088909207794,
						"close": 90.52345537844151,
						"volume": 67717.38214100001
					},
					{
						"time": 1645632900000,
						"open": 89.013322416637,
						"high": 89.013322416637,
						"low": 89.013322416637,
						"close": 89.013322416637,
						"volume": 2019.069545
					},
					{
						"time": 1645633560000,
						"open": 89.71395642465707,
						"high": 90.26237794862176,
						"low": 89.71395642465707,
						"close": 90.26237794862176,
						"volume": 4339.0077440000005
					},
					{
						"time": 1645636560000,
						"open": 90.77691093162667,
						"high": 91.60163114277908,
						"low": 90.77691093162667,
						"close": 90.97470591556686,
						"volume": 10531.179635
					},
					{
						"time": 1645638000000,
						"open": 90.06573252734486,
						"high": 90.06573252734486,
						"low": 90.06573252734486,
						"close": 90.06573252734486,
						"volume": 3145.943737
					},
					{
						"time": 1645638780000,
						"open": 89.28862014372183,
						"high": 89.28862014372183,
						"low": 89.28862014372183,
						"close": 89.28862014372183,
						"volume": 3023.423669
					},
					{
						"time": 1645639860000,
						"open": 88.5193333150793,
						"high": 88.5193333150793,
						"low": 88.5193333150793,
						"close": 88.5193333150793,
						"volume": 3110.218905
					},
					{
						"time": 1645643820000,
						"open": 88.83949950424459,
						"high": 88.83949950424459,
						"low": 88.83949950424459,
						"close": 88.83949950424459,
						"volume": 1422.988039
					},
					{
						"time": 1645645380000,
						"open": 88.07717576277602,
						"high": 88.07717576277602,
						"low": 88.07717576277602,
						"close": 88.07717576277602,
						"volume": 3264.634552
					},
					{
						"time": 1645646580000,
						"open": 87.26732126463716,
						"high": 87.26732126463716,
						"low": 87.26732126463716,
						"close": 87.26732126463716,
						"volume": 3237.852096
					},
					{
						"time": 1645651080000,
						"open": 87.82445178547471,
						"high": 87.82445178547471,
						"low": 87.82445178547471,
						"close": 87.82445178547471,
						"volume": 3508.346658
					},
					{
						"time": 1645652340000,
						"open": 87.35625500342894,
						"high": 87.35625500342894,
						"low": 87.35625500342894,
						"close": 87.35625500342894,
						"volume": 3042.440191
					},
					{
						"time": 1645654260000,
						"open": 86.5449939476983,
						"high": 86.5449939476983,
						"low": 86.5449939476983,
						"close": 86.5449939476983,
						"volume": 3498.05043
					},
					{
						"time": 1645654620000,
						"open": 85.55732618019346,
						"high": 85.55732618019346,
						"low": 85.55732618019346,
						"close": 85.55732618019346,
						"volume": 4505.314139
					},
					{
						"time": 1645655820000,
						"open": 85.60122360280877,
						"high": 85.60122360280877,
						"low": 85.60122360280877,
						"close": 85.60122360280877,
						"volume": 691.223061
					},
					{
						"time": 1645656720000,
						"open": 85.77512390657921,
						"high": 85.95191375827045,
						"low": 85.77512390657921,
						"close": 85.95191375827045,
						"volume": 1434.3863190000002
					},
					{
						"time": 1645657260000,
						"open": 86.1259765538146,
						"high": 86.1259765538146,
						"low": 85.10724043214226,
						"close": 85.10724043214226,
						"volume": 3426.0230719999995
					},
					{
						"time": 1645660800000,
						"open": 84.57360670084687,
						"high": 84.57360670084687,
						"low": 84.57360670084687,
						"close": 84.57360670084687,
						"volume": 3687.696126
					}
				]
			};
			// you can use the other data.
			if (data.Response && data.Response === 'Error' || data.Data.length === 0) {
				// "noData" should be set if there is no data in the requested period.
				onHistoryCallback([], {
					noData: true,
				});
				return;
			}

			let bars = [];

			data.Data.forEach(bar => {
				if (bar.time >= from * 1000 && bar.time < to * 1000) {
					bars = [...bars, {
						time: bar.time,
						low: bar.low,
						high: bar.high,
						open: bar.open,
						close: bar.close,
					}];
					console.log(bars, 1111)
				}
			});

			onHistoryCallback(bars, {
				noData: false,
			});
		} catch (error) {
			console.log('[getBars]: Get error', error);
			onErrorCallback(error);
		}
	},

	subscribeBars: (
		symbolInfo,
		resolution,
		onRealtimeCallback,
		subscribeUID,
		onResetCacheNeededCallback,
	) => {
		console.log('[subscribeBars]: Method call with subscribeUID:', subscribeUID);
		subscribeOnStream(
			symbolInfo,
			resolution,
			onRealtimeCallback,
			subscribeUID,
			onResetCacheNeededCallback,
			lastBarsCache.get(symbolInfo.full_name),
		);
	},

	unsubscribeBars: (subscriberUID) => {
		console.log('[unsubscribeBars]: Method call with subscriberUID:', subscriberUID);
		unsubscribeFromStream(subscriberUID);
	},
};
